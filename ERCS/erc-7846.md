---
eip: 7846
title: Wallet Connection API
description: Adds JSON-RPC method for requesting wallet connection with modular capabilities.
author: Conner Swenberg (@ilikesymmetry), Jake Moxey (@jxom), Lukas Rosario (@lukasrosario), Stephan Cilliers (@stephancill)
discussions-to: https://ethereum-magicians.org/t/erc-7846-wallet-connection-api/22245
status: Draft
type: Standards Track
category: ERC
created: 2024-12-15
---

## Abstract

This ERC introduces a new wallet connection JSON-RPC method focused on extensibility, `wallet_connect`. It leverages the modular capabilities approach defined in [ERC-5792](./eip-5792.md#wallet_getcapabilities) to streamline connections and authentication into a single interaction.

## Motivation

With applications beginning to require support for more sophisticated functionality in wallet connection flows, the need for a unified and extensible wallet connection JSON-RPC method has become more apparent.

This is especially evident in the case of attempting to batch connection with authentication, where existing methods like `eth_requestAccounts` and `personal_sign` lack extensibility and require at least two separate user interactions (ie. connect and then sign).

## Specification

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 and RFC 8174.

### JSON-RPC Methods

#### `wallet_connect`

Requests to connect account(s) with optional capabilities.

- An Application MAY provide a list of chain IDs (`chainIds`) to propose to the wallet to establish an initial connection with. 
- The Wallet MUST support at least one of the provided chain IDs. If the Wallet does not support any of the provided chain IDs, then the Wallet MUST reject with an `5710 Unsupported Chain` error.
- If the Application does not provide any chain IDs, then the Wallet MAY propose any chain ID it supports.
- If the Application requests to switch chain via a `wallet_switchEthereumChain` request at a later time, the Wallet MAY switch to the requested chain (even if not one of the chain IDs provided at connection) or reject with an `5710 Unsupported Chain` error if not supported.


##### Request

```ts
type Request = {
  method: 'wallet_connect',
  params: [{
    // Optional capabilities to request (e.g. Sign In With Ethereum).
    capabilities?: Record<string, unknown>;
    // Chain IDs to propose to the wallet to establish an initial connection with.
    chainIds?: `0x${string}`[];
    // JSON-RPC method version.
    version: '1';
  }]
}
```

##### Response

List of connected accounts with their associated capabilities.

```ts
type Response = {
  // Accounts established with this connection.
  accounts: {
    // Address of the connected account.
    address: `0x${string}`;
    // Capabilities granted that is associated with this account.
    capabilities: Record<string, unknown>;
  }[],
  // Initial chain IDs established with this connection.
  chainIds: `0x${string}`[]
}
```

##### Example

```ts
const response = await provider.request({
  method: 'wallet_connect',
  params: [{
    capabilities: {
      signInWithEthereum: {
        nonce: '12345678',
      }
    },
    chainIds: ['0x1', '0x2105'],
    version: '1',
  }]
})
/**
 * {
 *   accounts: [
 *     {
 *       address: '0x...',
 *       capabilities: {
 *         signInWithEthereum: {
 *           message: 'app.com wants you to sign in with your Ethereum account:\n0x...',
 *           signature: '0x...'
 *         }
 *       }
 *     }
 *   ],
 *   chainIds: ['0x1', '0xa', '0x2105', '0x31b51']
 * }
 */
```

#### `wallet_disconnect`

Disconnects connected account(s).

- The wallet SHOULD revoke access to the user account(s) information, as well as to any capabilities associated with them that were granted upon connection via `wallet_connect`.

##### Request

```ts
type Request = {
  method: 'wallet_disconnect'
}
```

##### Example

```ts
await provider.request({
  method: 'wallet_disconnect',
})
```

### Capabilities

#### `signInWithEthereum`

Adds support for offchain authentication using [ERC-4361](./eip-4361.md).

##### Parameters

Same as ERC-4361 specification with minor modifications: 
* The casing of multi-word fields has been adjusted to camelCase instead of kebab-case. Resources are an array field. 
* The account address returned by `wallet_connect` MUST match the address inferred in the Sign-In with Ethereum (SIWE) message.
* `chainId` is optional. If not provided, the Wallet MUST fill this field with one of the chain IDs requested on the `wallet_connect` request (or any chain ID the account supports if no chain IDs were requested).
* `version` is optional. If not provided, the Wallet MUST fill this field with an accepted version defined in ERC-4361.
* `domain` is optional. If not provided, the Wallet MUST fill this field with the domain of the requesting app.
* `uri` is optional. If not provided, the Wallet MUST fill this field with the uri of the requesting app.
* `issuedAt` is optional. If not provided, the Wallet MUST fill this field with the current time.

The wallet MUST return a ERC-4361-formatted message that exactly matches the requested parameters and a signature over the [EIP-191](./eip-191.md) `personal_sign` hash of the message. The app SHOULD also verify that the two match for security.

```ts
type Parameters = {
  signInWithEthereum: {
    nonce: string;
    chainId?: string; // EIP-155 hex-encoded
    domain?: string;
    expirationTime?: string;
    issuedAt?: string;
    notBefore?: string;
    requestId?: string;
    resources?: string[];
    scheme?: string;
    statement?: string;
    uri?: string;
    version?: string;
  }
}
```

##### Response

Formatted SIWE message and signature.

```ts
type Response = {
  signInWithEthereum: {
    // Formatted SIWE message.
    message: string;
    // Signature over the EIP-191 personal_sign hash of the message.
    signature: `0x${string}`;
  }
}
```

#### Example

```ts
const result = await provider.request({
  method: 'wallet_connect',
  params: [{
    capabilities: {
      signInWithEthereum: {
        domain: 'app.com',
        expirationTime: '2024-12-35T06:09:00Z'
        issuedAt: '2024-12-35T04:20:00Z',
        nonce: '12345678',
        uri: 'https://app.com/connect',
      }
    },
    chainIds: ['0x1', '0x2105'],
    version: '1'
  }]
})
/**
 * {
 *   accounts: [
 *     {
 *       address: '0x...',
 *       capabilities: {
 *         signInWithEthereum: {
 *           message: 'app.com wants you to sign in with your Ethereum account:\n0x...',
 *           signature: '0x...'
 *         }
 *       }
 *     }
 *   ],
 *   chainIds: ['0x1', '0xa', '0x2105', '0x31b51']
 * }
 */
```

## Rationale

### `chainIds` Request Parameter

In an ever-evolving "multichain" ecosystem, it is important for Applications to be able to connect to a Wallet without being constrained to supply a chain (or set of chains) to connect to. This specification allows for this flexibility by making chain IDs optional in the `wallet_connect` request. This allows an Application to 
more gracefully perform actions on any chain the Wallet supports.
However, if an Application is designed to support specific chains, the Application MAY provide a `chainIds` parameter to `wallet_connect` to request connection to at least one of the provided chain IDs. This may be
important for Applications that perform actions with contracts that reside on a chain, or perform [ERC-1271](https://eips.ethereum.org/EIPS/eip-1271) verification on Smart Contract Accounts.

### Multiple Accounts

Returning multiple accounts allows greater generality for apps that wish to interact in more complex ways with users. This also improves our backwards compatibility with `eth_requestAccounts`. In practice, we expect most apps only interact with the first account in the array.

### Capability Results

Returning capability results alongside the connection unlocks many valuable use cases such as authentication, user metadata sharing, and permissions granted to the app.

### Initial Authentication Capability

To ensure immediate value, this proposal includes a capability that combines wallet connection with authentication using the widely adopted [Sign In With Ethereum (ERC-4361)](./eip-4361.md) standard. This optional capability simplifies the onboarding process for apps and users by combining two steps — connection and authentication — into a single interaction. Apps that prefer alternative authentication flows can implement their own capabilities without being constrained by this design.

By unifying connection and authentication into one step, apps can reduce friction, improve the user experience, and minimize redundant interactions.

## Backwards Compatibility

This standard builds on existing JSON-RPC methods and complements ERC-5792 for future extensibility. Wallets can continue supporting legacy methods.

## Security Considerations

Applies [ERC-4361 security principles](./eip-4361.md#security-considerations). As more capabilities are added, care must be taken to avoid unpredictable interactions.

Wallet addresses and any shared capabilities must be handled securely to avoid data leaks or man-in-the-middle attacks.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
