---
eip: 7682
title: Auxiliary Funds Capability
description: A capability allowing wallets to indicate that they have access to additional funds.
author: Lukas Rosario (@lukasrosario), Wilson Cusack (@wilsoncusack)
discussions-to: https://ethereum-magicians.org/t/erc-7682-auxiliary-funds-capability/19599
status: Draft
type: Standards Track
category: ERC
created: 2024-04-09
requires: 5792
---

## Abstract

An [EIP-5792](./eip-5792.md) compliant capability that allows wallets to indicate to apps that they have access to funds beyond those that can be accounted for by looking up balances onchain given the wallet's address.

A wallet's ability to access auxiliary funds is communicated to apps as part of its response to an [EIP-5792](./eip-5792.md) `wallet_getCapabilities` request. The following standard does not specify the source of these auxiliary funds, but some examples are:

- Funds from offchain sources that can be onramped and used just-in-time
- Wallets that manage many accounts, where assets across those accounts can be transfered to the required account before submitting a transaction requested by an app

## Motivation

Many applications check users' balances before letting them complete some action. For example, if a user wants to swap some amount of tokens on a dex, the dex will commonly block the user from doing so if it sees that the user does not have that amount of tokens at their address. However, more advanced wallets have features that let users access funds from other sources. Wallets need a way to tell apps that they have access to additional funds so that users using these more advanced wallets are not blocked by balance checks.

## Specification

One new [EIP-5792](./eip-5792.md) wallet capability is defined.

### Wallet Implementation

To conform to this specification, wallets that wish to indicate that they have access to auxiliary funds MUST, for each chain they have access to auxiliary funds on, respond to `wallet_getCapabilities` calls with an `auxiliaryFunds` object with a `supported` field set to `true`.

Wallets may also optionally specify which assets they have additional access to with an `assets` field, which maps to an array of addresses representing the assets the wallet might have additional access to. If a wallet does not respond with this optional array of assets, the application SHOULD assume the wallet has additional access to any asset.

This specification does not put any constraints on the source of the auxiliary funds.

In this specification, a chain's native asset (e.g. Ether on Ethereum) MUST be represented by "0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE" as specified by [EIP-7528](./eip-7528).

#### `wallet_getCapabilities` Response Specification

```typescript
type AuxiliaryFundsCapability = {
  supported: boolean;
  assets?: `0x${string}`[];
}
```

##### `wallet_getCapabilities` Example Response

```json
{
  "0x2105": {
    "auxiliaryFunds": {
      "supported": true,
      "assets": [
        "0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",
        "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"
      ]
    }
  },
  "0x14A34": {
    "auxiliaryFunds": {
      "supported": true,
      "assets": [
        "0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",
        "0x036CbD53842c5426634e7929541eC2318f3dCF7e"
      ]
    }
  }
}
```

### Extended Usage: `assetsRequiredForExecution` Parameter

When a wallet indicates support for the `auxiliaryFunds` capability (i.e., `supported: true`), applications that use the [`wallet_sendCalls`](./eip-5792.md#wallet_sendcalls) method MUST include an additional parameter named `assetsRequiredForExecution` in the call. 

This parameter is necessary because transaction call data alone does not reliably indicate which assets and amounts are needed for successful execution. Calls may involve complex logic or multiple contracts, making it difficult for wallets to infer requirements. By specifying required assets and amounts explicitly, apps ensure wallets have the information needed to provision, bridge, or swap assets as necessary for the transaction to succeed.

### `wallet_sendCalls` Extended Parameter

The `assetsRequiredForExecution` parameter MUST be specified per call in the `calls` array. Each call object MAY include an `assetsRequiredForExecution` array, which details the assets and amounts required for that specific call.

```typescript
// Example call type extension
type WalletSendCall = {
  to: `0x${string}`;
  data: string;
  // ... other call fields ...
  assetsRequiredForExecution?: Array<{
    asset: `0x${string}`; // Asset address (use 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE for native asset)
    amount: string;        // Amount required, as a string representing the integer value in the asset's smallest unit
    decimals: number;      // Number of decimals for the asset (to interpret amount correctly)
  }>;
};
```

#### Example Scenario: Cross-Chain Deposit to Aave

Suppose a user wants to deposit DAI into Aave on Chain X, but their wallet address on Chain X has no DAI or native gas token. However, the wallet has access to funds on Chain Y (e.g., Ethereum mainnet). The app, upon detecting the `auxiliaryFunds` capability, can construct a `wallet_sendCalls` request as follows:

```json
{
  "calls": [
    {
      "to": "0xAaveDAIDepositContractOnChainX",
      "data": "0xd0e30db0", // Example encoded deposit function call
      "assetsRequiredForExecution": [
        {
          "asset": "0x6B175474E89094C44Da98b954EedeAC495271d0F", // DAI address on Chain X
          "amount": "1000000000000000000", // 1 DAI
          "decimals": 18
        },
        {
          "asset": "0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE", // Native asset for gas (e.g., ETH)
          "amount": "10000000000000000", // 0.01 ETH
          "decimals": 18
        }
      ]
    }
  ]
}
```

The wallet, upon receiving this request, can:
- Bridge or swap the required DAI from Chain Y to Chain X
- Ensure the user has enough native asset (e.g., ETH) for gas on Chain X
- Complete the deposit call to Aave on Chain X

This mechanism allows advanced wallets to abstract away the complexity of cross-chain or offchain funding, enabling seamless user experiences even when the user's onchain balance is insufficient on the target chain.

### App Implementation Guidance

When an app sees that a connected wallet has access to auxiliary funds via the `auxiliaryFunds` capability in a `wallet_getCapabilities` response, the app SHOULD NOT block users from taking actions on the basis of asset balance checks.

Apps SHOULD include the `assetsRequiredForExecution` parameter per call whenever they rely on the `auxiliaryFunds` capability to fulfill a user action. This ensures the wallet has the necessary information to provision assets as needed for successful execution.

## Rationale

### Alternatives

#### Advanced Balance Fetching

An alternative we considered is defining a way for apps to fetch available auxiliary balances. This could be done, for example, by providing a URL as part of the `auxiliaryFunds` capability that apps could use to fetch auxiliary balance information. However, we ultimately decided that a boolean was enough to indicate to apps that they should not block user actions on the basis of balance checks, and it is minimally burdensome for apps to implement.

The shape of this capability allows for a more advanced extension if apps feel more functionality is needed.

### Extensibility
- The structure of `assetsRequiredForExecution` allows for future extension, such as specifying deadlines, slippage, or preferred bridges. Future versions of this standard MAY introduce additional fields as needed.

### Decimals Source of Truth
- Applications and wallets SHOULD verify the `decimals` value for each asset against onchain data or trusted sources to avoid errors from incorrect values.

### Gas Estimation and Native Asset Handling
- Applications SHOULD include an estimate for the required native asset (e.g., ETH for gas) in `assetsRequiredForExecution` when possible.

## Backwards Compatibility
- Applications SHOULD only include the `assetsRequiredForExecution` parameter if the wallet advertises the `auxiliaryFunds` capability.
- If a wallet does not recognize or support the `assetsRequiredForExecution` parameter, it SHOULD ignore the parameter or return a clear error indicating lack of support. Apps SHOULD be prepared to handle such cases gracefully, potentially falling back to legacy behavior.

## Security Considerations

- Apps MUST NOT make any assumptions about the source of auxiliary funds. Apps' smart contracts should still, as they would today, make appropriate balance checks onchain when processing a transaction.
- Applications MUST NOT assume that the wallet will always be able to fulfill the asset requirements, and SHOULD handle failures gracefully.
- Wallets SHOULD provide clear error messages or status codes if they are unable to fulfill the asset requirements (e.g., insufficient offchain funds, bridge/swap failure, or unsupported assets).
- Consider whether specifying asset requirements per call could leak sensitive information about user intent or holdings. Where appropriate, apps and wallets SHOULD follow best practices to minimize privacy risks.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
