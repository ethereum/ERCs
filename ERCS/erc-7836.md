---
eip: 7836
title: Wallet Call Preparation API
description: Adds JSON-RPC methods for requesting prepared EIP-5792 calls.
author: Lukas Rosario (@lukasrosario), Conner Swenberg (@ilikesymmetry), Adam Hodges (@ajhodges), Paaras Bhandari (@paarasbhandari), Jake Moxey (@jxom)
discussions-to: https://ethereum-magicians.org/t/new-erc-wallet-call-preparation-api/22456
status: Draft
type: Standards Track
category: ERC
created: 2024-12-06
requires: 1193, 5792
---

## Abstract

This proposal defines complementary JSON-RPC methods to [EIP-5792's `wallet_sendCalls`](./eip-5792.md) to enable an Application to sign over a call bundle (instead of the Wallet). Methods defined in this proposal are purposed for the Application to sign over `calls` and submit them to the Wallet with an accompanying signature. This is in contrast to `wallet_sendCalls`, where a Wallet itself signs over the call bundle.

## Motivation

With the advent of Account Abstraction (and Permissions), there is an increasing need for Applications to be able to sign and submit actions without needing to switch to a Wallet interface (e.g. browser extension). As Smart Contract Accounts (SCAs) contain arbitrary execution interfaces that leads to varying calldata formats, it is not possible for an Application to know how to sign over an action for any arbitrary Account implementation. They would need to maintain a mapping of Account implementations to their signing logic.

## Specification

In this specification, we define two new JSON-RPC methods: `wallet_prepareCalls` and `wallet_sendPreparedCalls`.

### `wallet_prepareCalls`

Instructs a Wallet to prepare a call bundle according to the Account's implementation. It returns a `digest` of the call bundle to sign over, as well as the parameters required to fulfil a `wallet_sendPreparedCalls` request (ie. `capabilities`, `chainId`, `context`, and `version`).

> After calling `wallet_prepareCalls`, consumers are expected to sign over the `digest` and submit the `signature` and prepared calls to the Wallet via `wallet_sendPreparedCalls`.

#### Request

> The request is identical to that of [`wallet_sendCalls`](./eip-5792.md).

```typescript
type Request = {
  method: 'wallet_prepareCalls',
  params: [{
    version: string;
    chainId: `0x${string}`;
    from?: `0x${string}`;
    calls: {
      to: `0x${string}`;
      data?: `0x${string}`;
      value?: `0x${string}`;
      capabilities?: Record<string, any>;
    }[];
    capabilities?: Record<string, any>
  }]
}
```

#### Response

> The response is intended to be forwarded to `wallet_sendPreparedCalls` (minus the `digest`).

```typescript
type Response = {
  // Capabilities to be forwarded to `wallet_sendPreparedCalls`.
  capabilities: Record<string, any>
  // Chain ID of the chain the calls are being submitted to.
  chainId: `0x${string}`
  // Wallet-specific data to be forwarded to `wallet_sendPreparedCalls` 
  // (e.g. ERC-4337 UserOperation object, bundle type, etc.).
  context: unknown
  // Digest of the call bundle to sign over.
  digest: `0x${string}`
  // JSON-RPC method version.
  version: string
}
```

#### Example

```typescript
const response = await provider.request({
  method: 'wallet_prepareCalls',
  params: [{
    calls: [{
      to: '0xcafebabecafebabecafebabecafebabecafebabe',
      data: '0xdeadbeef',
    }],
    capabilities: {
      paymasterService: {
        url: 'https://...',
      },
    },
    chainId: '0x1',
    version: '1',
  }]
})
/**
 * {
 *   capabilities: {
 *     paymasterService: {
 *       url: 'https://...'
 *     }
 *   },
 *   chainId: '0x1',
 *   context: { ... },
 *   signatureRequest: {
 *     digest: '0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef'
 *   },
 *   version: '1',
 * }
 */
```

### `wallet_sendPreparedCalls`

Instructs a Wallet to execute a prepared call bundle (response of `wallet_prepareCalls`) with an accompanying `signature`. 

#### Parameters

> The request is identical to the response of `wallet_prepareCalls`, except that it includes a `signature`.

```typescript
type Request = {
  method: 'wallet_sendPreparedCalls',
  params: [{
    // Capabilities.
    capabilities: Record<string, any>
    // Chain ID of the chain the calls are being submitted to.
    chainId: `0x${string}`
    // Wallet-specific data. 
    // (e.g. ERC-4337 UserOperation object, bundle type, etc.).
    context: unknown
    // Signature of the call bundle.
    signature: {
      // Signature type (e.g. secp256k1, p256, etc).
      type: string,
      // Signature value.
      value: `0x${string}`,
    }
    // JSON-RPC method version.
    version: string
  }]
}
```

#### Response

> The response is identical to that of `wallet_sendCalls`, except that it is a list.

```typescript
type Response = {
  id: string,
  capabilities: Record<string, any>
}[]
```

#### Example

```typescript
const request = await provider.request({
  method: 'wallet_prepareCalls',
  params: [{
    calls: [{
      to: '0xcafebabecafebabecafebabecafebabecafebabe',
      data: '0xdeadbeef',
    }],
    capabilities: {
      paymasterService: {
        url: 'https://...',
      },
    },
    chainId: '0x1',
    version: '1',
  }]
})

const signature = p256.sign(request.digest, privateKey)

const response = await provider.request({
  method: 'wallet_sendPreparedCalls',
  params: [{
    ...request,
    signature: {
      type: 'p256',
      value: signature,
    }
  }]
})
/**
 * [
 *   {
 *     id: '0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef',
 *   }
 * ]
 */
```

## Rationale

Many session key use cases involve submitting operations on users' behalves. One example is an application that automates a user's DEX trading. In these cases, the wallet may provide a "wallet server" URL for the app to submit JSON-RPC requests to outside of the context of a browser.

It is not in the scope of this EIP, but someone could define a `walletServer` [EIP-5792](./eip-5792.md) capability that declares a public wallet server URL.

```json
{
  "0x2105": {
    "walletServer": {
      "supported": true,
      "url": "https://.../0x2105"
    }
  },
  "0x14A34": {
    "walletServer": {
      "supported": true,
      "url": "https://.../0x14A34"
    }
  }
}
```

If a wallet's [EIP-1193](./eip-1193.md) provider receives these requests, it might choose to reroute the request to its own wallet server. Alternatively, the [EIP-1193](./eip-1193.md) provider can handle the requests directly.

![walletserver](../assets/eip-7836/0.svg)

## Backwards Compatibility

TBD

## Security Considerations

Needs discussion.

## Copyright

Copyright and related rights waived via [CC0](../LICENSE.md).
